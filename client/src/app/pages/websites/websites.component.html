<div class="websites-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>{{ 'websites.title' | translate }}</h1>
      <p>{{ 'websites.subtitle' | translate }}</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <i class="fa-solid fa-plus"></i>
      {{ 'websites.createWebsite' | translate }}
    </button>
  </div>

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat-item">
      <span class="stat-value">{{ websiteStats.total }}</span>
      <span class="stat-label">{{ 'dashboard.stats.totalWebsites' | translate }}</span>
    </div>
    <div class="stat-item active">
      <span class="stat-value">{{ websiteStats.active }}</span>
      <span class="stat-label">{{ 'websites.status.active' | translate }}</span>
    </div>
    <div class="stat-item installing">
      <span class="stat-value">{{ websiteStats.installing }}</span>
      <span class="stat-label">{{ 'websites.status.installing' | translate }}</span>
    </div>
    <div class="stat-item suspended">
      <span class="stat-value">{{ websiteStats.suspended }}</span>
      <span class="stat-label">{{ 'websites.status.suspended' | translate }}</span>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="search-box">
      <i class="fa-solid fa-search"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        [placeholder]="'websites.search' | translate">
    </div>

    <div class="filter-group">
      <label>{{ 'websites.filterByStatus' | translate }}:</label>
      <select [(ngModel)]="statusFilter" (ngModelChange)="onStatusFilterChange()">
        <option value="all">{{ 'websites.allStatuses' | translate }}</option>
        <option value="active">{{ 'websites.status.active' | translate }}</option>
        <option value="installing">{{ 'websites.status.installing' | translate }}</option>
        <option value="suspended">{{ 'websites.status.suspended' | translate }}</option>
        <option value="error">{{ 'websites.status.error' | translate }}</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>{{ 'common.loading' | translate }}...</p>
  </div>

  <!-- Websites Grid -->
  <div class="websites-grid" *ngIf="!isLoading && filteredWebsites.length > 0">
    <div class="website-card" *ngFor="let website of filteredWebsites">
      <div class="website-card-header">
        <div class="website-icon">
          <i class="fa-solid fa-globe"></i>
        </div>
        <div class="website-status" [ngClass]="getStatusClass(website.status)">
          <i class="fa-solid" [ngClass]="getStatusIcon(website.status)"></i>
          {{ 'websites.status.' + website.status | translate }}
        </div>
      </div>

      <div class="website-card-body">
        <h3>{{ website.name }}</h3>
        <p class="website-path">{{ website.site_path }}</p>

        <div class="website-stats">
          <div class="stat">
            <i class="fa-solid fa-hard-drive"></i>
            <span>{{ formatBytes(website.disk_usage) }}</span>
          </div>
          <div class="stat" *ngIf="website.last_backup_at">
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span>{{ website.last_backup_at | date:'short' }}</span>
          </div>
        </div>
      </div>

      <div class="website-card-footer">
        <button class="btn-secondary" [routerLink]="['/websites', website.id]">
          <i class="fa-solid fa-eye"></i>
          {{ 'websites.actions.view' | translate }}
        </button>
        <button class="btn-secondary">
          <i class="fa-solid fa-cog"></i>
          {{ 'websites.actions.manage' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && filteredWebsites.length === 0 && websites.length === 0">
    <i class="fa-solid fa-globe"></i>
    <h3>{{ 'websites.noWebsites' | translate }}</h3>
    <p>{{ 'websites.createFirstWebsite' | translate }}</p>
    <button class="btn-primary" (click)="openCreateModal()">
      <i class="fa-solid fa-plus"></i>
      {{ 'websites.createWebsite' | translate }}
    </button>
  </div>

  <!-- No Results -->
  <div class="empty-state" *ngIf="!isLoading && filteredWebsites.length === 0 && websites.length > 0">
    <i class="fa-solid fa-search"></i>
    <h3>{{ 'common.noData' | translate }}</h3>
    <p>{{ 'websites.noWebsites' | translate }}</p>
  </div>
</div>

<!-- Create Website Modal -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ 'websites.createModal.title' | translate }}</h2>
      <button class="close-btn" (click)="closeCreateModal()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div *ngIf="createError" class="error-message">
        <i class="fa-solid fa-exclamation-circle"></i>
        {{ createError }}
      </div>

      <form (ngSubmit)="createWebsite()">
        <div class="form-group">
          <label>{{ 'websites.createModal.domainName' | translate }} *</label>
          <input
            type="text"
            [(ngModel)]="newWebsite.name"
            name="name"
            [placeholder]="'websites.createModal.domainPlaceholder' | translate"
            [disabled]="isCreating"
            required>
          <small class="help-text">Enter a valid domain name like example.com</small>
        </div>

        <div class="form-group">
          <label>{{ 'websites.createModal.phpVersion' | translate }}</label>
          <select [(ngModel)]="newWebsite.phpVersion" name="phpVersion" [disabled]="isCreating">
            <option value="7.4">PHP 7.4</option>
            <option value="8.0">PHP 8.0</option>
            <option value="8.1">PHP 8.1</option>
            <option value="8.2">PHP 8.2</option>
            <option value="8.3">PHP 8.3</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeCreateModal()" [disabled]="isCreating">
            {{ 'websites.createModal.cancel' | translate }}
          </button>
          <button type="submit" class="btn-primary" [disabled]="isCreating">
            <i class="fa-solid" [ngClass]="isCreating ? 'fa-spinner fa-spin' : 'fa-plus'"></i>
            {{ isCreating ? ('common.loading' | translate) : ('websites.createModal.create' | translate) }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
